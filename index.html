<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nala Aircon Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #0ea5e9; --primary-dark: #0284c7; --success: #10b981; --warning: #f59e0b;
            --danger: #ef4444; --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb;
            --gray-300: #d1d5db; --text-primary: #1e293b; --text-secondary: #64748b;
            --bg-primary: #ffffff; --sidebar-bg: #1e293b; --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1); --radius: 8px; --radius-lg: 12px;
        }
        
        body { font-family: 'Inter', sans-serif; background: var(--gray-50); color: var(--text-primary); line-height: 1.6; font-size: 14px; }
        .dashboard-layout { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 280px; background: var(--sidebar-bg); color: white; position: fixed; left: 0; top: 0; height: 100vh; overflow-y: auto; z-index: 1000; box-shadow: var(--shadow-lg); }
        .sidebar.collapsed { width: 80px; }
        .sidebar-header { padding: 24px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 12px; }
        .sidebar-logo { width: 48px; height: 48px; background: linear-gradient(135deg, var(--primary), #38bdf8); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .sidebar-title { flex: 1; }
        .sidebar.collapsed .sidebar-title { display: none; }
        .sidebar-title h1 { font-size: 20px; font-weight: 700; }
        .sidebar-title p { font-size: 12px; opacity: 0.7; }
        
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: rgba(255,255,255,0.8); cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .nav-item:hover { background: #334155; color: white; }
        .nav-item.active { background: rgba(14,165,233,0.2); color: #38bdf8; border-left: 3px solid #38bdf8; }
        .nav-icon { width: 20px; font-size: 20px; text-align: center; }
        .nav-text { flex: 1; }
        .sidebar.collapsed .nav-text { display: none; }
        
        .sidebar-footer { position: absolute; bottom: 0; left: 0; right: 0; padding: 16px 20px; border-top: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); }
        .firebase-status { display: flex; align-items: center; gap: 8px; font-size: 12px; font-weight: 500; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .status-dot.connected { background: var(--success); animation: pulse 2s ease-in-out infinite; }
        .status-dot.connecting { background: var(--warning); animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Main Content */
        .main-content { flex: 1; margin-left: 280px; }
        .sidebar.collapsed ~ .main-content { margin-left: 80px; }
        
        .top-bar { background: var(--bg-primary); border-bottom: 1px solid var(--gray-200); padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: var(--shadow); }
        .top-bar-left { display: flex; align-items: center; gap: 16px; }
        .menu-toggle { width: 40px; height: 40px; border: none; background: var(--gray-100); border-radius: var(--radius); cursor: pointer; font-size: 20px; color: var(--text-primary); }
        .page-title { font-size: 24px; font-weight: 700; }
        
        .search-bar { position: relative; width: 400px; }
        .search-bar input { width: 100%; padding: 10px 16px 10px 44px; border: 1px solid var(--gray-300); border-radius: var(--radius-lg); font-size: 14px; }
        .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(14,165,233,0.1); }
        .search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        
        /* Buttons */
        .btn { padding: 10px 20px; border: none; border-radius: var(--radius); font-size: 14px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; box-shadow: var(--shadow); transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-secondary { background: var(--gray-200); color: var(--text-primary); }
        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .btn-whatsapp { background: #25D366; color: white; }
        
        /* Content Area */
        .content-area { padding: 32px; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 32px; }
        .stat-card { background: var(--bg-primary); border-radius: var(--radius-lg); padding: 24px; box-shadow: var(--shadow); border: 1px solid var(--gray-200); position: relative; overflow: hidden; }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
        .stat-card:nth-child(1)::before { background: linear-gradient(90deg, var(--primary), #38bdf8); }
        .stat-card:nth-child(2)::before { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
        .stat-card:nth-child(3)::before { background: linear-gradient(90deg, var(--success), #34d399); }
        .stat-card:nth-child(4)::before { background: linear-gradient(90deg, var(--warning), #fbbf24); }
        .stat-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        
        .stat-header { display: flex; justify-content: space-between; margin-bottom: 16px; }
        .stat-icon { width: 56px; height: 56px; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .stat-card:nth-child(1) .stat-icon { background: rgba(14,165,233,0.1); color: var(--primary); }
        .stat-card:nth-child(2) .stat-icon { background: rgba(139,92,246,0.1); color: #8b5cf6; }
        .stat-card:nth-child(3) .stat-icon { background: rgba(16,185,129,0.1); color: var(--success); }
        .stat-card:nth-child(4) .stat-icon { background: rgba(245,158,11,0.1); color: var(--warning); }
        .stat-value { font-size: 32px; font-weight: 800; line-height: 1; margin-bottom: 8px; }
        .stat-label { font-size: 14px; color: var(--text-secondary); font-weight: 500; }
        
        /* Action Bar */
        .action-bar { background: var(--bg-primary); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 24px; box-shadow: var(--shadow); display: flex; justify-content: space-between; flex-wrap: wrap; gap: 16px; border: 1px solid var(--gray-200); }
        .action-group, .filter-group { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
        
        /* Alert */
        .alert { padding: 12px 16px; border-radius: var(--radius); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; font-size: 14px; font-weight: 500; }
        .alert-warning { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); color: #92400e; }
        
        /* Customer Cards */
        .customers-grid { display: grid; gap: 24px; }
        .customer-card { background: var(--bg-primary); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow); border: 1px solid var(--gray-200); }
        .customer-card.duplicate { border: 2px solid var(--warning); }
        .customer-header { background: linear-gradient(135deg, var(--primary), #0284c7); padding: 24px; color: white; cursor: pointer; position: relative; }
        .customer-main { display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px; }
        .customer-info { flex: 1; }
        .customer-name { font-size: 20px; font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .customer-id { font-size: 11px; padding: 4px 8px; background: rgba(255,255,255,0.2); border-radius: 6px; font-weight: 600; }
        .duplicate-badge { font-size: 11px; padding: 4px 8px; background: var(--warning); color: white; border-radius: 6px; font-weight: 600; }
        .customer-contact { display: flex; flex-wrap: wrap; gap: 16px; font-size: 14px; }
        .customer-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .customer-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .customer-stat { text-align: center; padding: 12px; background: rgba(255,255,255,0.1); border-radius: var(--radius); }
        .customer-stat-value { font-size: 24px; font-weight: 700; line-height: 1; margin-bottom: 4px; }
        .customer-stat-label { font-size: 11px; text-transform: uppercase; font-weight: 600; }
        
        .expand-indicator { position: absolute; right: 24px; top: 24px; font-size: 20px; transition: transform 0.3s; }
        .customer-card.expanded .expand-indicator { transform: rotate(180deg); }
        
        .customer-details { display: none; }
        .customer-card.expanded .customer-details { display: block; }
        
        /* Tabs */
        .details-tabs { display: flex; background: var(--gray-100); border-bottom: 1px solid var(--gray-200); }
        .tab-btn { flex: 1; padding: 16px; background: transparent; border: none; color: var(--text-secondary); cursor: pointer; font-weight: 600; position: relative; }
        .tab-btn.active { color: var(--primary); }
        .tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px; background: var(--primary); }
        .tab-content { padding: 24px; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        
        /* AC Units */
        .ac-units-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
        .ac-unit-card { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: var(--radius-lg); padding: 20px; }
        .ac-unit-number { display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; background: var(--primary); color: white; border-radius: 50%; font-weight: 700; margin-bottom: 12px; }
        
        /* Service History */
        .service-timeline { position: relative; padding-left: 40px; }
        .service-timeline::before { content: ''; position: absolute; left: 15px; top: 0; bottom: 0; width: 2px; background: var(--gray-200); }
        .service-item { position: relative; background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 16px; }
        .service-item::before { content: ''; position: absolute; left: -30px; top: 24px; width: 14px; height: 14px; background: var(--success); border-radius: 50%; border: 3px solid white; box-shadow: 0 0 0 2px var(--gray-200); }
        .service-type { font-size: 16px; font-weight: 700; margin-bottom: 12px; }
        .service-info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15,23,42,0.7); backdrop-filter: blur(4px); z-index: 2000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-primary); border-radius: var(--radius-lg); width: 90%; max-width: 700px; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); }
        .modal-header { padding: 24px; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 20px; font-weight: 700; }
        .modal-close { width: 36px; height: 36px; border: none; background: var(--gray-100); border-radius: var(--radius); cursor: pointer; font-size: 20px; }
        .modal-close:hover { background: var(--danger); color: white; }
        .modal-body { padding: 24px; }
        
        /* Form */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; background: var(--bg-primary); border: 1px solid var(--gray-300); border-radius: var(--radius); font-size: 14px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(14,165,233,0.1); }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .form-section { background: var(--gray-50); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 20px; border: 1px solid var(--gray-200); }
        .form-section-title { font-size: 16px; font-weight: 700; margin-bottom: 16px; }
        .form-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--gray-200); }
        
        /* Toast */
        .toast { position: fixed; bottom: 24px; right: 24px; padding: 16px 20px; background: white; border-radius: var(--radius-lg); font-size: 14px; font-weight: 600; box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 12px; transform: translateX(400px); transition: transform 0.3s; border-left: 4px solid var(--success); z-index: 3000; min-width: 300px; }
        .toast.show { transform: translateX(0); }
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--warning); }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 80px 20px; background: var(--bg-primary); border-radius: var(--radius-lg); border: 2px dashed var(--gray-300); }
        .empty-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }
        .empty-title { font-size: 24px; font-weight: 700; margin-bottom: 12px; }
        .empty-text { font-size: 16px; color: var(--text-secondary); margin-bottom: 30px; }
        
        /* Loading */
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .loading-overlay.show { opacity: 1; pointer-events: all; }
        .spinner { width: 50px; height: 50px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.mobile-open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .search-bar { width: 100%; }
            .stats-grid { grid-template-columns: 1fr; }
            .customer-stats { grid-template-columns: repeat(2, 1fr); }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="dashboard-layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">‚ùÑÔ∏è</div>
                <div class="sidebar-title">
                    <h1>Nala Aircon</h1>
                    <p>Service Management</p>
                </div>
            </div>
            <nav class="sidebar-nav" style="padding: 20px 0;">
                <a class="nav-item active"><span class="nav-icon">üìä</span><span class="nav-text">Dashboard</span></a>
                <a class="nav-item"><span class="nav-icon">üì•</span><span class="nav-text" onclick="exportData()">Export Data</span></a>
                <a class="nav-item"><span class="nav-icon">üìã</span><span class="nav-text" onclick="downloadTemplate()">Template</span></a>
            </nav>
            <div class="sidebar-footer">
                <div class="firebase-status" id="firebaseStatus">
                    <span class="status-dot connecting"></span>
                    <span>Connecting...</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <div class="top-bar-left">
                    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                    <h1 class="page-title">Dashboard</h1>
                </div>
                <div class="search-bar">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="Search customers..." onkeyup="searchCustomers()">
                </div>
                <button class="btn btn-primary" onclick="openCustomerModal()">‚ûï Add Customer</button>
            </div>

            <div class="content-area">
                <div id="duplicateAlert" style="display: none;"></div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header"><div class="stat-icon">üë•</div></div>
                        <div class="stat-value" id="totalCustomers">0</div>
                        <div class="stat-label">Total Customers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header"><div class="stat-icon">‚ùÑÔ∏è</div></div>
                        <div class="stat-value" id="totalAC">0</div>
                        <div class="stat-label">AC Units</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header"><div class="stat-icon">üîß</div></div>
                        <div class="stat-value" id="totalServices">0</div>
                        <div class="stat-label">Total Services</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header"><div class="stat-icon">üí∞</div></div>
                        <div class="stat-value" id="totalRevenue">Rp 0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                </div>

                <div class="action-bar">
                    <div class="action-group">
                        <button class="btn btn-success" onclick="loadSampleData()">üìä Sample Data</button>
                        <button class="btn btn-warning" onclick="syncWithFirebase()">üîÑ Sync</button>
                    </div>
                    <div class="filter-group">
                        <label>Filter by Month:</label>
                        <input type="month" id="monthFilter" onchange="filterByMonth()">
                        <button class="btn btn-sm btn-secondary" onclick="clearFilter()">Clear</button>
                    </div>
                </div>

                <div class="customers-grid" id="customersContainer">
                    <div class="empty-state">
                        <div class="empty-icon">üì¶</div>
                        <div class="empty-title">No Customers Yet</div>
                        <div class="empty-text">Start by adding your first customer</div>
                        <button class="btn btn-primary" onclick="openCustomerModal()">Add First Customer</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add New Customer</h2>
                <button class="modal-close" onclick="closeModal('customerModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="customerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Customer Name *</label>
                            <input type="text" id="customerName" required>
                        </div>
                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" id="customerPhone" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Address *</label>
                        <textarea id="customerAddress" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Number of AC Units *</label>
                            <input type="number" id="acCount" min="1" max="20" value="1" required onchange="generateACForms()">
                        </div>
                        <div class="form-group">
                            <label>Primary AC Brand</label>
                            <select id="acBrand">
                                <option value="">Select Brand</option>
                                <option value="Daikin">Daikin</option>
                                <option value="LG">LG</option>
                                <option value="Samsung">Samsung</option>
                                <option value="Panasonic">Panasonic</option>
                                <option value="Sharp">Sharp</option>
                                <option value="Mitsubishi">Mitsubishi</option>
                                <option value="Aux">Aux</option>
                            </select>
                        </div>
                    </div>
                    <div id="acFormsContainer"></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('customerModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Customer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Service Modal -->
    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Service Record</h2>
                <button class="modal-close" onclick="closeModal('serviceModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="serviceForm">
                    <input type="hidden" id="serviceCustomerId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Service Date *</label>
                            <input type="date" id="serviceDate" required>
                        </div>
                        <div class="form-group">
                            <label>Technician *</label>
                            <select id="serviceTechnician" required>
                                <option value="">Select Technician</option>
                                <option value="Beta">Beta</option>
                                <option value="Charlie">Charlie</option>
                                <option value="Delta">Delta</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Service Type *</label>
                            <select id="serviceType" required>
                                <option value="">Select Type</option>
                                <option value="Cuci AC">Cuci AC</option>
                                <option value="Pengecekan">Pengecekan</option>
                                <option value="Troubleshooting">Troubleshooting</option>
                                <option value="Pasang AC">Pasang AC</option>
                                <option value="Freon">Freon Refill</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Payment (Rp) *</label>
                            <input type="number" id="servicePayment" min="0" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Service Notes</label>
                        <textarea id="serviceNotes"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('serviceModal')">Cancel</button>
                        <button type="submit" class="btn btn-success">Save Service</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div style="margin-top: 20px; font-weight: 600;">Loading...</div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDocs, onSnapshot, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBI5T3ZVyHXSRFikTjSlnW9P04cO1UDAwg",
            authDomain: "databasebesar.firebaseapp.com",
            projectId: "databasebesar",
            storageBucket: "databasebesar.firebasestorage.app",
            messagingSenderId: "253231829334",
            appId: "1:253231829334:web:e46fd18ef04b83d6c546f7"
        };

        let app, db, isFirebaseInitialized = false, unsubscribe;

        async function autoInitializeFirebase() {
            try {
                updateFirebaseStatus('connecting');
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                isFirebaseInitialized = true;
                updateFirebaseStatus('connected');
                showToast('Connected to Firebase!', 'success');
                await loadDataFromFirebase();
                setupFirebaseListener();
            } catch (error) {
                console.error('Firebase error:', error);
                updateFirebaseStatus('error');
                showToast('Firebase connection failed', 'error');
            }
        }

        function updateFirebaseStatus(status) {
            const el = document.getElementById('firebaseStatus');
            const dot = el.querySelector('.status-dot');
            const text = el.querySelector('span:last-child');
            if (status === 'connected') {
                dot.className = 'status-dot connected';
                text.textContent = 'Connected';
                window.isFirebaseReady = true;
            } else if (status === 'connecting') {
                dot.className = 'status-dot connecting';
                text.textContent = 'Connecting...';
            }
        }

        async function loadDataFromFirebase() {
            if (!isFirebaseInitialized) return;
            try {
                showLoading(true);
                const snapshot = await getDocs(collection(db, 'customers'));
                const loaded = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    loaded.push({
                        id: doc.id,
                        ...data,
                        createdAt: data.createdAt?.toDate?.()?.toISOString() || new Date().toISOString(),
                        updatedAt: data.updatedAt?.toDate?.()?.toISOString() || new Date().toISOString()
                    });
                });
                loaded.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
                window.customers = loaded;
                updateStats();
                renderCustomers();
                checkDuplicates();
            } catch (error) {
                console.error('Load error:', error);
                showToast('Error loading data', 'error');
            } finally {
                showLoading(false);
            }
        }

        function setupFirebaseListener() {
            if (!isFirebaseInitialized || unsubscribe) return;
            unsubscribe = onSnapshot(collection(db, 'customers'), snapshot => {
                const updated = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    updated.push({
                        id: doc.id,
                        ...data,
                        createdAt: data.createdAt?.toDate?.()?.toISOString() || new Date().toISOString(),
                        updatedAt: data.updatedAt?.toDate?.()?.toISOString() || new Date().toISOString()
                    });
                });
                updated.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
                window.customers = updated;
                updateStats();
                renderCustomers();
                checkDuplicates();
            });
        }

        window.firebaseHelpers = {
            saveCustomerToFirebase: async (data) => {
                if (!isFirebaseInitialized) throw new Error('Firebase not ready');
                const ref = await addDoc(collection(db, 'customers'), {
                    ...data,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                });
                return ref.id;
            },
            updateCustomerInFirebase: async (id, data) => {
                if (!isFirebaseInitialized) throw new Error('Firebase not ready');
                await updateDoc(doc(db, 'customers', id), { ...data, updatedAt: serverTimestamp() });
            },
            deleteCustomerFromFirebase: async (id) => {
                if (!isFirebaseInitialized) throw new Error('Firebase not ready');
                await deleteDoc(doc(db, 'customers', id));
            }
        };

        window.syncWithFirebase = async () => {
            if (!isFirebaseInitialized) {
                showToast('Firebase not connected', 'error');
                return;
            }
            await loadDataFromFirebase();
            showToast('Synced!', 'success');
        };

        autoInitializeFirebase();
    </script>

    <script>
        let customers = [], editingCustomerId = null, monthFilter = null;
        window.customers = [];

        function initApp() {
            generateACForms();
            document.getElementById('serviceDate').value = new Date().toISOString().split('T')[0];
        }

        window.toggleSidebar = () => {
            document.getElementById('sidebar').classList.toggle(window.innerWidth <= 768 ? 'mobile-open' : 'collapsed');
        };

        function checkDuplicates() {
            const seen = {}, dups = [];
            window.customers.forEach(c => {
                const key = `${c.name?.toLowerCase()}-${c.phone}`;
                if (seen[key]) dups.push({ c1: seen[key], c2: c });
                else seen[key] = c;
            });
            const alert = document.getElementById('duplicateAlert');
            if (dups.length > 0) {
                alert.style.display = 'block';
                alert.className = 'alert alert-warning';
                alert.innerHTML = `<span>‚ö†Ô∏è</span><div><strong>Data Ganda!</strong><br>Ditemukan ${dups.length} customer dengan nama/nomor sama.</div>`;
                dups.forEach(d => {
                    document.getElementById(`customer-${d.c1.id}`)?.classList.add('duplicate');
                    document.getElementById(`customer-${d.c2.id}`)?.classList.add('duplicate');
                });
            } else {
                alert.style.display = 'none';
            }
        }

        window.sendWhatsAppReminder = (id) => {
            const c = window.customers.find(x => x.id === id);
            if (!c) return;
            const last = c.services?.[0];
            let msg = `Halo ${c.name},\n\nKami dari Nala Aircon ingin mengingatkan Anda untuk perawatan AC.\n\n`;
            if (last) {
                msg += `Terakhir service: ${formatDateIndo(last.date)} (${last.type}).\n\n`;
            }
            msg += `Hubungi kami untuk jadwal service.\n\nTerima kasih,\nNala Aircon Team`;
            let phone = c.phone.replace(/\D/g, '');
            if (!phone.startsWith('62')) phone = phone.startsWith('0') ? '62' + phone.substring(1) : '62' + phone;
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
            showToast('Opening WhatsApp...', 'success');
        };

        function formatDateIndo(d) {
            if (!d) return 'Tidak ada';
            const date = new Date(d);
            const m = ['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
            return `${date.getDate()} ${m[date.getMonth()]} ${date.getFullYear()}`;
        }

        window.openCustomerModal = (id = null) => {
            if (!window.isFirebaseReady) return showToast('Wait for Firebase', 'error');
            const modal = document.getElementById('customerModal');
            const form = document.getElementById('customerForm');
            const title = document.getElementById('modalTitle');
            editingCustomerId = id;
            if (id) {
                title.textContent = 'Edit Customer';
                const c = window.customers.find(x => x.id === id);
                if (c) {
                    document.getElementById('customerName').value = c.name || '';
                    document.getElementById('customerPhone').value = c.phone || '';
                    document.getElementById('customerAddress').value = c.address || '';
                    document.getElementById('acCount').value = c.acUnits?.length || 1;
                    document.getElementById('acBrand').value = c.acUnits?.[0]?.brand || '';
                    generateACForms();
                    setTimeout(() => {
                        c.acUnits?.forEach((u, i) => {
                            if (document.getElementById(`ac_brand_${i}`)) {
                                document.getElementById(`ac_brand_${i}`).value = u.brand || '';
                                document.getElementById(`ac_type_${i}`).value = u.type || 'Split Wall';
                                document.getElementById(`ac_capacity_${i}`).value = u.capacity || '1 PK';
                                document.getElementById(`ac_location_${i}`).value = u.location || '';
                            }
                        });
                    }, 100);
                }
            } else {
                title.textContent = 'Add New Customer';
                form.reset();
                document.getElementById('acCount').value = 1;
                generateACForms();
            }
            modal.style.display = 'block';
        };

        window.generateACForms = () => {
            const count = parseInt(document.getElementById('acCount').value) || 1;
            const container = document.getElementById('acFormsContainer');
            const brand = document.getElementById('acBrand').value;
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const sec = document.createElement('div');
                sec.className = 'form-section';
                sec.innerHTML = `
                    <h4 class="form-section-title">AC Unit ${i + 1}</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Brand</label>
                            <select id="ac_brand_${i}">
                                <option value="">Select Brand</option>
                                <option ${brand==='Daikin'?'selected':''} value="Daikin">Daikin</option>
                                <option ${brand==='LG'?'selected':''} value="LG">LG</option>
                                <option ${brand==='Samsung'?'selected':''} value="Samsung">Samsung</option>
                                <option ${brand==='Panasonic'?'selected':''} value="Panasonic">Panasonic</option>
                                <option ${brand==='Sharp'?'selected':''} value="Sharp">Sharp</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Type</label>
                            <select id="ac_type_${i}">
                                <option value="Split Wall">Split Wall</option>
                                <option value="Cassette">Cassette</option>
                                <option value="Standing">Standing</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Capacity</label>
                            <select id="ac_capacity_${i}">
                                <option value="0.5 PK">0.5 PK</option>
                                <option value="1 PK" selected>1 PK</option>
                                <option value="1.5 PK">1.5 PK</option>
                                <option value="2 PK">2 PK</option>
                                <option value="3 PK">3 PK</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="ac_location_${i}" placeholder="e.g., Living Room">
                        </div>
                    </div>
                `;
                container.appendChild(sec);
            }
        };

        document.getElementById('customerForm').onsubmit = async (e) => {
            e.preventDefault();
            if (!window.isFirebaseReady) return showToast('Firebase not ready', 'error');
            try {
                showLoading(true);
                const count = parseInt(document.getElementById('acCount').value) || 1;
                const units = [];
                for (let i = 0; i < count; i++) {
                    units.push({
                        brand: document.getElementById(`ac_brand_${i}`)?.value || '',
                        type: document.getElementById(`ac_type_${i}`)?.value || 'Split Wall',
                        capacity: document.getElementById(`ac_capacity_${i}`)?.value || '1 PK',
                        location: document.getElementById(`ac_location_${i}`)?.value || ''
                    });
                }
                const data = {
                    name: document.getElementById('customerName').value.trim(),
                    phone: document.getElementById('customerPhone').value.trim(),
                    address: document.getElementById('customerAddress').value.trim(),
                    acUnits: units,
                    services: editingCustomerId ? (window.customers.find(c => c.id === editingCustomerId)?.services || []) : []
                };
                if (editingCustomerId) {
                    await window.firebaseHelpers.updateCustomerInFirebase(editingCustomerId, data);
                    showToast('Customer updated!', 'success');
                } else {
                    await window.firebaseHelpers.saveCustomerToFirebase(data);
                    showToast('Customer added!', 'success');
                }
                closeModal('customerModal');
            } catch (err) {
                console.error(err);
                showToast('Error: ' + err.message, 'error');
            } finally {
                showLoading(false);
            }
        };

        window.deleteCustomer = async (id) => {
            if (!window.isFirebaseReady || !confirm('Delete this customer?')) return;
            try {
                showLoading(true);
                await window.firebaseHelpers.deleteCustomerFromFirebase(id);
                showToast('Customer deleted', 'success');
            } catch (err) {
                showToast('Error: ' + err.message, 'error');
            } finally {
                showLoading(false);
            }
        };

        window.openServiceModal = (id) => {
            if (!window.isFirebaseReady) return showToast('Wait for Firebase', 'error');
            document.getElementById('serviceCustomerId').value = id;
            document.getElementById('serviceForm').reset();
            document.getElementById('serviceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('serviceModal').style.display = 'block';
        };

        document.getElementById('serviceForm').onsubmit = async (e) => {
            e.preventDefault();
            if (!window.isFirebaseReady) return showToast('Firebase not ready', 'error');
            try {
                showLoading(true);
                const id = document.getElementById('serviceCustomerId').value;
                const c = window.customers.find(x => x.id === id);
                if (c) {
                    const srv = {
                        id: 'SRV' + Date.now(),
                        date: document.getElementById('serviceDate').value,
                        technician: document.getElementById('serviceTechnician').value,
                        type: document.getElementById('serviceType').value,
                        payment: parseInt(document.getElementById('servicePayment').value) || 0,
                        notes: document.getElementById('serviceNotes').value,
                        createdAt: new Date().toISOString()
                    };
                    if (!c.services) c.services = [];
                    c.services.unshift(srv);
                    await window.firebaseHelpers.updateCustomerInFirebase(id, {
                        name: c.name, phone: c.phone, address: c.address,
                        acUnits: c.acUnits, services: c.services
                    });
                    closeModal('serviceModal');
                    showToast('Service added!', 'success');
                }
            } catch (err) {
                showToast('Error: ' + err.message, 'error');
            } finally {
                showLoading(false);
            }
        };

        window.deleteService = async (cid, sid) => {
            if (!window.isFirebaseReady || !confirm('Delete service?')) return;
            try {
                showLoading(true);
                const c = window.customers.find(x => x.id === cid);
                if (c?.services) {
                    c.services = c.services.filter(s => s.id !== sid);
                    await window.firebaseHelpers.updateCustomerInFirebase(cid, {
                        name: c.name, phone: c.phone, address: c.address,
                        acUnits: c.acUnits, services: c.services
                    });
                    showToast('Service deleted', 'success');
                }
            } catch (err) {
                showToast('Error: ' + err.message, 'error');
            } finally {
                showLoading(false);
            }
        };

        function getFilteredCustomers() {
            if (!monthFilter) return window.customers || [];
            const [y, m] = monthFilter.split('-');
            return (window.customers || []).filter(c => {
                if (!c.services?.length) return false;
                return c.services.some(s => {
                    const d = new Date(s.date);
                    return d.getFullYear().toString() === y && (d.getMonth() + 1).toString().padStart(2, '0') === m;
                });
            });
        }

        function renderCustomers(search = '') {
            const container = document.getElementById('customersContainer');
            let filtered = getFilteredCustomers();
            if (search) {
                filtered = filtered.filter(c =>
                    c.name?.toLowerCase().includes(search.toLowerCase()) ||
                    c.phone?.includes(search) ||
                    c.address?.toLowerCase().includes(search.toLowerCase())
                );
            }
            if (monthFilter) {
                const [y, m] = monthFilter.split('-');
                filtered = filtered.map(c => ({
                    ...c,
                    services: (c.services || []).filter(s => {
                        const d = new Date(s.date);
                        return d.getFullYear().toString() === y && (d.getMonth() + 1).toString().padStart(2, '0') === m;
                    })
                }));
            }
            if (!filtered.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì¶</div>
                        <div class="empty-title">No Customers</div>
                        <div class="empty-text">${search || monthFilter ? 'Try different filters' : 'Add your first customer'}</div>
                        ${!search && !monthFilter ? '<button class="btn btn-primary" onclick="openCustomerModal()">Add Customer</button>' : ''}
                    </div>
                `;
                return;
            }
            const dupIds = new Set();
            const seen = {};
            filtered.forEach(c => {
                const k = `${c.name?.toLowerCase()}-${c.phone}`;
                if (seen[k]) {
                    dupIds.add(c.id);
                    dupIds.add(seen[k].id);
                } else seen[k] = c;
            });
            container.innerHTML = filtered.map(c => {
                const total = c.services?.length || 0;
                const pay = c.services?.reduce((s, x) => s + (x.payment || 0), 0) || 0;
                const last = c.services?.[0];
                const dup = dupIds.has(c.id);
                return `
                    <div class="customer-card ${dup ? 'duplicate' : ''}" id="customer-${c.id}">
                        <div class="customer-header" onclick="toggleCustomerCard('${c.id}')">
                            <div class="customer-main">
                                <div class="customer-info">
                                    <div class="customer-name">
                                        ${c.name || 'No Name'}
                                        <span class="customer-id">#${c.id.substring(0, 8)}</span>
                                        ${dup ? '<span class="duplicate-badge">‚ö†Ô∏è DUPLICATE</span>' : ''}
                                    </div>
                                    <div class="customer-contact">
                                        <span>üì± ${c.phone || '-'}</span>
                                        <span>üìç ${c.address || '-'}</span>
                                    </div>
                                </div>
                                <div class="customer-actions">
                                    <button class="btn btn-sm btn-whatsapp" onclick="event.stopPropagation(); sendWhatsAppReminder('${c.id}')">üí¨ Reminder</button>
                                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); openServiceModal('${c.id}')">+ Service</button>
                                    <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); openCustomerModal('${c.id}')">‚úèÔ∏è</button>
                                    <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteCustomer('${c.id}')">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="customer-stats">
                                <div class="customer-stat">
                                    <div class="customer-stat-value">${c.acUnits?.length || 0}</div>
                                    <div class="customer-stat-label">AC Units</div>
                                </div>
                                <div class="customer-stat">
                                    <div class="customer-stat-value">${total}</div>
                                    <div class="customer-stat-label">Services</div>
                                </div>
                                <div class="customer-stat">
                                    <div class="customer-stat-value">${formatCurrency(pay)}</div>
                                    <div class="customer-stat-label">Revenue</div>
                                </div>
                                <div class="customer-stat">
                                    <div class="customer-stat-value">${last ? formatDate(last.date) : 'Never'}</div>
                                    <div class="customer-stat-label">Last Service</div>
                                </div>
                            </div>
                            <span class="expand-indicator">‚ñº</span>
                        </div>
                        <div class="customer-details">
                            <div class="details-tabs">
                                <button class="tab-btn active" onclick="switchTab('${c.id}', 'units')">AC Units</button>
                                <button class="tab-btn" onclick="switchTab('${c.id}', 'history')">Service History</button>
                            </div>
                            <div class="tab-content">
                                <div class="tab-pane active" id="tab-units-${c.id}">
                                    <div class="ac-units-grid">
                                        ${(c.acUnits || []).map((u, i) => `
                                            <div class="ac-unit-card">
                                                <div class="ac-unit-number">${i + 1}</div>
                                                <div style="font-size: 13px; line-height: 1.8; color: var(--text-secondary);">
                                                    <strong>${u.brand || 'Unknown'}</strong><br>
                                                    Type: ${u.type || '-'}<br>
                                                    Capacity: ${u.capacity || '-'}<br>
                                                    ${u.location ? `Location: ${u.location}` : ''}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="tab-pane" id="tab-history-${c.id}">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                                        <h3 style="font-size: 18px; font-weight: 700;">Service History</h3>
                                        <button class="btn btn-sm btn-success" onclick="openServiceModal('${c.id}')">+ Add Service</button>
                                    </div>
                                    ${c.services?.length ? `
                                        <div class="service-timeline">
                                            ${c.services.map(s => `
                                                <div class="service-item">
                                                    <div style="font-size: 12px; color: var(--text-light); font-weight: 600; margin-bottom: 8px;">${formatDate(s.date)}</div>
                                                    <div class="service-type">${s.type || 'Unknown'}</div>
                                                    <div class="service-info-grid">
                                                        <div><div style="color: var(--text-secondary); font-size: 13px;">Technician</div><div style="font-weight: 600;">${s.technician || '-'}</div></div>
                                                        <div><div style="color: var(--text-secondary); font-size: 13px;">Payment</div><div style="font-weight: 600;">${formatCurrency(s.payment || 0)}</div></div>
                                                    </div>
                                                    ${s.notes ? `<div style="font-size: 13px; padding: 12px; background: white; border-left: 3px solid var(--primary); border-radius: var(--radius); margin-top: 12px;">${s.notes}</div>` : ''}
                                                    <div style="display: flex; gap: 8px; margin-top: 12px; justify-content: flex-end;">
                                                        <button class="btn btn-sm btn-danger" onclick="deleteService('${c.id}', '${s.id}')">Delete</button>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : '<div style="text-align: center; padding: 60px; color: var(--text-secondary);">No service history</div>'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.toggleCustomerCard = (id) => document.getElementById(`customer-${id}`)?.classList.toggle('expanded');

        window.switchTab = (id, tab) => {
            const card = document.getElementById(`customer-${id}`);
            if (!card) return;
            card.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            card.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById(`tab-${tab}-${id}`)?.classList.add('active');
        };

        function updateStats() {
            let stats = window.customers || [];
            if (monthFilter) {
                const [y, m] = monthFilter.split('-');
                stats = stats.filter(c => c.services?.some(s => {
                    const d = new Date(s.date);
                    return d.getFullYear().toString() === y && (d.getMonth() + 1).toString().padStart(2, '0') === m;
                })).map(c => ({
                    ...c,
                    services: c.services.filter(s => {
                        const d = new Date(s.date);
                        return d.getFullYear().toString() === y && (d.getMonth() + 1).toString().padStart(2, '0') === m;
                    })
                }));
            }
            const ac = stats.reduce((s, c) => s + (c.acUnits?.length || 0), 0);
            const srv = stats.reduce((s, c) => s + (c.services?.length || 0), 0);
            const rev = stats.reduce((s, c) => s + (c.services?.reduce((x, y) => x + (y.payment || 0), 0) || 0), 0);
            document.getElementById('totalCustomers').textContent = stats.length;
            document.getElementById('totalAC').textContent = ac;
            document.getElementById('totalServices').textContent = srv;
            document.getElementById('totalRevenue').textContent = formatCurrency(rev);
        }

        window.searchCustomers = () => renderCustomers(document.getElementById('searchInput').value);

        window.filterByMonth = () => {
            monthFilter = document.getElementById('monthFilter').value || null;
            renderCustomers(document.getElementById('searchInput').value);
            updateStats();
            if (monthFilter) showToast('Filter applied', 'success');
        };

        window.clearFilter = () => {
            monthFilter = null;
            document.getElementById('monthFilter').value = '';
            renderCustomers(document.getElementById('searchInput').value);
            updateStats();
            showToast('Filter cleared', 'success');
        };

        window.closeModal = (id) => {
            document.getElementById(id).style.display = 'none';
            editingCustomerId = null;
        };

        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('show', show);
        }

        function formatCurrency(amt) {
            if (amt >= 1000000) return 'Rp ' + (amt / 1000000).toFixed(1) + 'M';
            if (amt >= 1000) return 'Rp ' + (amt / 1000).toFixed(0) + 'K';
            return 'Rp ' + amt.toLocaleString('id-ID');
        }

        function formatDate(d) {
            if (!d) return '-';
            const date = new Date(d);
            const m = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            return `${date.getDate()} ${m[date.getMonth()]} ${date.getFullYear()}`;
        }

        function showToast(msg, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è' };
            toast.innerHTML = `<span style="font-size: 20px;">${icons[type]}</span> ${msg}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        window.exportData = () => {
            const blob = new Blob([JSON.stringify(window.customers, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `nala-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('Data exported!', 'success');
        };

        window.downloadTemplate = () => {
            const data = [
                ['Name*', 'Phone*', 'Address*', 'AC1 Brand', 'AC1 Type', 'AC1 Capacity', 'AC1 Location'],
                ['PT. Contoh', '021-12345678', 'Jl. Contoh 123', 'Daikin', 'Split Wall', '1 PK', 'Office']
            ];
            const csv = data.map(r => r.map(c => typeof c === 'string' && c.includes(',') ? `"${c}"` : c).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'nala-template.csv';
            a.click();
            showToast('Template downloaded!', 'success');
        };

        window.loadSampleData = async () => {
            if (!window.isFirebaseReady || (window.customers.length && !confirm('Add sample data?'))) return;
            try {
                showLoading(true);
                await window.firebaseHelpers.saveCustomerToFirebase({
                    name: 'PT. Maju Bersama',
                    phone: '021-5551234',
                    address: 'Gedung Menara Lt. 15, Jl. TB Simatupang, Jakarta',
                    acUnits: [
                        { brand: 'Daikin', type: 'Cassette', capacity: '2 PK', location: 'Meeting Room' },
                        { brand: 'Mitsubishi', type: 'Standing', capacity: '3 PK', location: 'Lobby' }
                    ],
                    services: [{
                        id: 'SRV001',
                        date: '2025-01-15',
                        technician: 'Beta',
                        type: 'Cuci AC',
                        payment: 850000,
                        notes: 'Monthly routine service',
                        createdAt: '2025-01-15T08:00:00Z'
                    }]
                });
                showToast('Sample data loaded!', 'success');
            } catch (err) {
                showToast('Error: ' + err.message, 'error');
            } finally {
                showLoading(false);
            }
        };

        window.onclick = (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
                editingCustomerId = null;
            }
        };

        document.addEventListener('DOMContentLoaded', initApp);
        if (document.readyState !== 'loading') initApp();
    </script>
</body>
</html>
